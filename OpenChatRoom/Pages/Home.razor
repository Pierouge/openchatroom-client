@page "/"
@layout Layout.EmptyLayout
@inject NavigationManager Navigation
@inject ApiClient apiClient
@inject Blazored.SessionStorage.ISyncSessionStorageService sessionStorage
@inject Blazored.LocalStorage.ISyncLocalStorageService localStorage

Redirecting...

@code{
    protected async override Task OnInitializedAsync(){

        // TODO: login check

        // Connect check
        try{
            switch (await ConnectionService.checkLogin(sessionStorage, localStorage, apiClient)) {
                case (ConnectionService.loginStates.credentials):{
                    Navigation.NavigateTo(uri: "app");
                    break;
                }
                case (ConnectionService.loginStates.server):{
                    Navigation.NavigateTo(uri: "login");
                    break;
                }
                default :{
                    Navigation.NavigateTo("connect");
                    break;
                } 
            }
        }
        catch(NavigationException){ // Catch the first error, as it crashes the whole system
            throw; // Then rethrow the error so Blazor still navigates to the next page
        }
    }
}
